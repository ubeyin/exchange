<!DOCTYPE html>
<html lang="en">
<head>
  <title>Page title</title>
  <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-firestore.js"></script>
  <script src="/__/init.js"></script>
</head>
<body>
  <input type="email" id="email" placeholder="Email address">
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="signup()">Sign up</button>
  <button onclick="signin()">Sign in</button>
  <button onclick="google()">Sign in with google</button>
  <br><br>
  <button onclick="signout()">Sign out</button>

  <script>
    var firebaseConfig = {
        apiKey: "AIzaSyAE9eqPw5-XTBwx0gIRZGpKxftLm8uS6NU",
        authDomain: "ubeyin-data.firebaseapp.com",
        databaseURL: "https://ubeyin-data-default-rtdb.firebaseio.com",
        projectId: "ubeyin-data",
        storageBucket: "ubeyin-data.appspot.com",
        messagingSenderId: "154658789445",
        appId: "1:154658789445:web:ab9dde4fd5e795c4d62b2c",
        measurementId: "G-6W9W2FJW3X"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    
    var f = firebase;
    var auth = f.auth();
    var database = firebase.database();
     
   

    if (f) {
      console.info(f);
    } else {
      console.error("Error! firebase is not located.");
    }

    function signup() {
      var e = document.getElementById("email").value;
      var p = document.getElementById("password").value;
      firebase.auth().createUserWithEmailAndPassword(e, p)
      .then((userCredential) => {
        // Signed in
        var user = userCredential.user;

        writeUserData(user.uid, "", user.email, "");
        alert("Welcome dear, "+user.email);
      })
      .catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;

        alert(error.message);
      });
    }

    function signin() {
      var e = document.getElementById("email").value;
      var p = document.getElementById("password").value;
      firebase.auth().signInWithEmailAndPassword(e, p)
      .then((userCredential) => {
        // Signed in
        var user = userCredential.user;
        alert("Welcome back, "+user.email);
      })
      .catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;

        alert(error.message);
      });
    }


    function google() {
      var provider = new firebase.auth.GoogleAuthProvider();
      provider.addScope('https://www.googleapis.com/auth/contacts.readonly');
      firebase.auth().useDeviceLanguage();
      provider.setCustomParameters({
        'login_hint': 'user@gmail.com'
      });
      firebase.auth()
      .signInWithRedirect(provider)
      .then((result) => {
        var credential = result.credential;
        var user = result.user;

      }).catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;

        var email = error.email;
        var credential = error.credential;

        alert(errorMessage);
      });
    }

    /*
    firebase.auth().signInWithPopup(provider);
  */


    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        var uid = user.uid;
        console.log(firebase.database().ref('users/'+uid));
        alert("Welcome back, "+user.email+"\n Your id: "+uid);
      } else {
        // User is signed out
        alert("Please, join now");
      }
    });


    function signout() {
      firebase.auth().signOut().then(() => {
        alert("Sign-out successful.");
      }).catch((error) => {
        alert("An error happened.");
      });
    }

    function writeUserData(userId, name, email, imageUrl) {
      firebase.database().ref('users/' + userId).set({
        username: name,
        email: email,
        profile_picture: imageUrl
      });
    }

  </script>
</body>
</html>
